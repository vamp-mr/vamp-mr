@PACKAGE_INIT@

include(CMakeFindDependencyMacro)

find_dependency(Eigen3 3.4)
find_dependency(Boost COMPONENTS system filesystem date_time thread serialization)
find_dependency(OpenMP)
find_dependency(Protobuf)
find_dependency(TBB QUIET)
find_dependency(yaml-cpp)
find_dependency(jsoncpp CONFIG)

# Some environments provide TBB via a raw `libtbb.so` without exporting `TBB::tbb`.
# The exported targets may reference `TBB::tbb`, so create a minimal imported
# target if we can locate the library.
if(NOT TARGET TBB::tbb)
  find_library(MR_PLANNER_CORE_TBB_LIBRARY NAMES tbb)
  if(MR_PLANNER_CORE_TBB_LIBRARY)
    add_library(TBB::tbb UNKNOWN IMPORTED)
    set_target_properties(TBB::tbb PROPERTIES IMPORTED_LOCATION "${MR_PLANNER_CORE_TBB_LIBRARY}")
  endif()
endif()

set(MR_PLANNER_CORE_ENABLE_VAMP "@MR_PLANNER_CORE_ENABLE_VAMP@")
if(MR_PLANNER_CORE_ENABLE_VAMP)
  find_dependency(vamp CONFIG)

  # VAMP's exported target references nigh::nigh and pdqsort::pdqsort. In some
  # layouts these may not be imported automatically, so opportunistically load
  # the installed target files from the VAMP prefix.
  if((NOT TARGET nigh::nigh) OR (NOT TARGET pdqsort::pdqsort))
    set(_mr_planner_vamp_prefix "")
    if(DEFINED vamp_DIR)
      get_filename_component(_mr_planner_vamp_prefix "${vamp_DIR}/../../.." ABSOLUTE)
    endif()
    foreach(_mr_planner_libdir IN ITEMS lib lib64 "lib/x86_64-linux-gnu")
      if(_mr_planner_vamp_prefix)
        set(_mr_planner_nigh_targets "${_mr_planner_vamp_prefix}/${_mr_planner_libdir}/cmake/nigh/nighTargets.cmake")
        if(EXISTS "${_mr_planner_nigh_targets}" AND NOT TARGET nigh::nigh)
          include("${_mr_planner_nigh_targets}")
        endif()

        set(_mr_planner_pdqsort_targets "${_mr_planner_vamp_prefix}/${_mr_planner_libdir}/cmake/pdqsort/pdqsortTargets.cmake")
        if(EXISTS "${_mr_planner_pdqsort_targets}" AND NOT TARGET pdqsort::pdqsort)
          include("${_mr_planner_pdqsort_targets}")
        endif()
      endif()
    endforeach()
    unset(_mr_planner_pdqsort_targets)
    unset(_mr_planner_nigh_targets)
    unset(_mr_planner_libdir)
    unset(_mr_planner_vamp_prefix)
  endif()
endif()

include("${CMAKE_CURRENT_LIST_DIR}/mr_planner_coreTargets.cmake")
